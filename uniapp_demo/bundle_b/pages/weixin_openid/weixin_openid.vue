<!-- 
	1. å¾®ä¿¡å®˜æ–¹æ–‡æ¡£: https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html
	2. å¦‚æœæ‚¨å’Œåç«¯å·²ç»åœ¨è°ƒè¯•å¾®ä¿¡ç™»å½•åŠŸèƒ½äº†ï¼Œé‚£å°±åˆ«ç”¨ç”³è¯·çš„æµ‹è¯•å…¬ä¼—å·äº†(æµ‹è¯•å…¬ä¼—å·ä»…ä¸ºäº†å‰ç«¯è‡ªå·±è°ƒè¯•åŠŸèƒ½)
	3. ä»£ç ä¸­å‡ºç°çš„ä¸€äº›å‚æ•°,å…¨éƒ¨å»å®˜æ–¹æ–‡æ¡£çœ‹,å…¨éƒ½æœ‰è§£é‡Š
	4. è¯·å……åˆ†ç†è§£,å¹¶æŒ‰ç…§æ‚¨çš„éœ€æ±‚æ›´æ”¹,æ¯ä¸ªäººçš„éœ€æ±‚ä¸åŒ
	
	â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	
	ã€æç¤º"redirect_urlå‚æ•°é”™è¯¯"ï¼Œå¯åˆ©ç”¨æŠ€æœ¯"ä¼ªé€ çº¿ä¸Šç¯å¢ƒ"ã€‘
	ã€æç¤º"redirect_urlå‚æ•°é”™è¯¯"ï¼Œå¯åˆ©ç”¨æŠ€æœ¯"ä¼ªé€ çº¿ä¸Šç¯å¢ƒ"ã€‘
	ã€ç”±äºå‰ç«¯æœ¬åœ°ç¯å¢ƒ192.168.xxå¹¶ä¸æ˜¯å…¬ä¼—å·åå°è®¾ç½®çš„ç½‘é¡µæˆæƒå›è°ƒåŸŸå,æ‰€ä»¥ä¸å¯èƒ½ä¼šæˆæƒæˆåŠŸ(æç¤ºredirect_urlå‚æ•°é”™è¯¯),æ‚¨éœ€è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š,å†è¿›è¡Œæµ‹è¯•ã€‘
	ã€å¦‚æœæ‚¨è§‰å¾—æ¯æ¬¡éƒ¨ç½²åˆ°æœåŠ¡å™¨è°ƒè¯•å¤ªéº»çƒ¦,æƒ³è¦åœ¨æœ¬åœ°(192.168.xx)ç¯å¢ƒä¸‹ç›´æ¥è°ƒè¯•åŠŸèƒ½,è¯·å‚è€ƒå¦‚ä¸‹è§£å†³æ–¹æ¡ˆã€‘
	ã€https://wangjiabin.blog.csdn.net/article/details/127787561ã€‘
	ã€æ–‡ç« å†…æ˜¯å¾®ä¿¡å¼€æ”¾å¹³å°,æ¢æˆå¾®ä¿¡å…¬ä¼—å¹³å°å³å¯,ç»“æœæ˜¯ä¸€æ ·çš„æ”¾å¿ƒã€‘
	ã€æ³¨æ„ï¼ï¼ï¼è¯·å°†uni-appé»˜è®¤ç«¯å£ä»8080æ”¹ä¸º80ï¼Œå¦åˆ™æ— æ•ˆï¼Œå¯å‚è€ƒhttps://wangjiabin.blog.csdn.net/article/details/128081481ã€‘
	
	â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	
	ã€å¦‚æœæ‚¨æŒ‰ç…§ä¸Šé¢çš„æ–‡ç« è¿›è¡Œäº†"ä¼ªé€ çº¿ä¸Šç¯å¢ƒ"æ“ä½œï¼Œç»“æœæ‰“å¼€ç½‘é¡µä»…æ˜¾ç¤º â€œInvalid Host headerâ€ é»‘è‰²æ–‡å­—ã€‘
	ã€è¯·æŒ‰å¦‚ä¸‹æ–‡ç« é¡ºåºä¾æ¬¡è¿›è¡Œæ“ä½œğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ã€‘
	ã€1. é¦–å…ˆå°†8080é»˜è®¤ç«¯å£æ”¹ä¸º80(æ”¹äº†çš„è¯ç›´æ¥ä¸‹ä¸€æ­¥)ï¼Œè¯¦è§ï¼šhttps://wangjiabin.blog.csdn.net/article/details/128081481ã€‘
	ã€2. ç„¶åå†é…ç½®ä¸€ä¸‹ï¼Œè¯¦è§ï¼šhttps://wangjiabin.blog.csdn.net/article/details/128082511ã€‘
	ã€ä¸Šé¢ä¸¤ä¸ªæ“ä½œæ‰§è¡Œåï¼Œä¾¿å¯é¡ºåˆ©æ‰“å¼€é¡¹ç›®,å¯ä»¥æ„‰å¿«çš„è¿›è¡Œæœ¬åœ°"ä¼ªé€ çº¿ä¸Šç¯å¢ƒ"å¼€å§‹è°ƒè¯•äº†ã€‘
-->

<template>
	<view>
		<button @click="login()">ç‚¹å‡»ç™»å½•</button>
	</view>
</template>

<script>
export default {
	data(){
		return {
			testLink:'http://data.szdepin.com/web/wechat/webAuth?app_id=2&app_name=depin_public_mp&back_url=pages%2Findex%2Findex',
		}	
	},
	onLoad() {
		// æ£€æµ‹æ˜¯å¦å®Œæˆç™»å½•
		this.testing()
	},
	
	methods: {
		
		/**
		 * æ£€æµ‹æ˜¯å¦å®Œæˆç™»å½•
		 * @description åˆ¤æ–­å‚æ•°æ˜¯å¦æœ‰code
		 */
		testing() {
			// code
			const code = this.getUrlParam('code')
			// åˆ¤æ–­æ˜¯å¦å­˜åœ¨codeå‚æ•°
			if(code) {
				// å­˜åœ¨çš„è¯,æ‹¿codeå»è¯·æ±‚åç«¯æ¥å£,è·å–ç”¨æˆ·ä¿¡æ¯
				this.getUserInfo(code)
			}else{
				// console.log('ä¸å­˜åœ¨code')
			}
		},
		
		/**
		 * ç‚¹å‡»ç™»å½•
		 * @description é…ç½®å¥½å‚æ•°,å¼€å§‹ç™»å½•
		 * @return void
		 */
		login() {
			// å»ºè®®ä»åç«¯æ¥å£è·å–appid(éå¿…é¡»,ç›´æ¥ä»å…¬ä¼—å·å¤åˆ¶è¿‡æ¥å†™æ­»ä¹Ÿè¡Œ)
			const data = {
				// å…¬ä¼—å·appID
				appid: 'wx11683108c5129eab',
				// æˆæƒåé‡å®šå‘çš„å›è°ƒé“¾æ¥åœ°å€(éœ€urlEncodeå¯¹é“¾æ¥è¿›è¡Œå¤„ç†)
				redirect_uri: encodeURIComponent(window.location.href),
				// è¿”å›ç±»å‹(é»˜è®¤code)
				response_type: 'code',
				// åº”ç”¨æˆæƒä½œç”¨åŸŸ(æ ¹æ®è‡ªå·±éœ€æ±‚æ¥)
				scope: 'snsapi_userinfo',
				// é¢å¤–å‚æ•°
				state: ''
			}
			// è¿›è¡Œå¾®ä¿¡ç™»å½•
			this.weixin(data)
		},
		
		/**
		 * å¾®ä¿¡æˆæƒç™»å½•
		 * @description ä¼ é€’å‚æ•°å¹¶å‘èµ·è·³è½¬
		 * @param {Object} data - æ‰€éœ€å‚æ•°
		 * @return void
		 */
		weixin(data) {
			// ç™»å½•ä¹‹å‰çš„å…¶ä»–æ“ä½œ
			// ...
			// è·³è½¬ç½‘é¡µå¼€å§‹ç™»å½•
			let wxurl = 'http://data.szdepin.com/web/wechat/webAuth?app_id=2&app_name=depin_public_mp&back_url=pages%2Findex%2Findex';
			window.location.href = `${wxurl}`
		},
		
		/**
		 * è·å–ç”¨æˆ·ä¿¡æ¯
		 * @description ä¼ ç»™æ¥å£code,æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯åè¿›è¡Œæ“ä½œ
		 * @param {String} code - code
		 * @return void
		 */
		getUserInfo(code) {
			console.log('å½“å‰code',code)
			uni.request({
			    url: 'xx',//æ¥å£åœ°å€ã€‚
			    data: { code: code },//codeå‡­è¯
			    success: (res) => {
					// ç”¨æˆ·ä¿¡æ¯
			        console.log(res.data)
					// é©¬ä¸Šå†™å…¥ç¼“å­˜
					uni.setStorageSync('login', res.data);
					// ç™»å½•å®Œï¼Œæ‚¨è¦ä¸è¦è·³è½¬é¡µé¢?
					// uni.redirectTo({
					// 	url: 'xxx'
					// })
			    }
			})
		},
		
		/**
		 * è§£æURLå‚æ•°
		 * @description æˆªå–è·¯ç”±å‚æ•°
		 * @param {String} name - è¦è§£æçš„è·¯ç”±å‚æ•°
		 * @return String
		 */
		getUrlParam(name) {
			let reg = new RegExp('(^|&)'+ name + '=([^&]*)(&|$)')
			let r = window.location.search.substr(1).match(reg)
			if(r != null){// ok
				return unescape(r[2])
			}
			// false
			return null
		},
		
	}
}
</script>

<style scoped>

</style>
