require('../../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["bundle/pages/files_upload/files_upload"],{1147:function(e,o,t){"use strict";var n=t("a473"),s=t.n(n);s.a},"3c3e":function(e,o,t){"use strict";t.r(o);var n=t("8bac"),s=t("d857");for(var i in s)["default"].indexOf(i)<0&&function(e){t.d(o,e,(function(){return s[e]}))}(i);t("1147");var c=t("f0c5"),a=Object(c["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);o["default"]=a.exports},"8bac":function(e,o,t){"use strict";t.d(o,"b",(function(){return s})),t.d(o,"c",(function(){return i})),t.d(o,"a",(function(){return n}));var n={navBar:function(){return t.e("components/nav-bar/nav-bar").then(t.bind(null,"38cb"))},uInput:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-input/u-input")]).then(t.bind(null,"4df1"))}},s=function(){var e=this.$createElement,o=(this._self._c,this.maxSelect>this.recordPhotoes.length||-1==this.maxSelect);this.$mp.data=Object.assign({},{$root:{g0:o}})},i=[]},a473:function(e,o,t){},d857:function(e,o,t){"use strict";t.r(o);var n=t("fd7d"),s=t.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){t.d(o,e,(function(){return n[e]}))}(i);o["default"]=s.a},ee42:function(e,o,t){"use strict";(function(e,o){var n=t("4ea4");t("aecd");n(t("66fd"));var s=n(t("3c3e"));e.__webpack_require_UNI_MP_PLUGIN__=t,o(s.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},fd7d:function(e,o,t){"use strict";(function(e){var n=t("4ea4");Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var s=t("05d0"),i=n(t("540d")),c=(t("ea09"),n(t("826d")),n(t("647c")),t("d3ef"),{components:{zyTag:function(){t.e("components/zy-tag/zy-tag").then(function(){return resolve(t("d908"))}.bind(null,t)).catch(t.oe)},catSignature:function(){t.e("bundle/components/sign-canvas/sign-canvas").then(function(){return resolve(t("77de"))}.bind(null,t)).catch(t.oe)}},data:function(){return{appraisePerson:{},itemSn:"",order_id:"",step_id:"",mapInstance:null,recordPhotoes:[],maxCount:4,imageUrl:[],attach:"",isAuth:-1,nurserLocation:{latitude:"",longitude:"",address:""},isShowSign:!1,signImage:"",wasteSortList:[{checked:!1,name:"感染性废物"},{checked:!1,name:"损伤性废物"},{checked:!1,name:"化学性废物"},{checked:!1,name:"药物性废物"},{checked:!1,name:"病理性废物"},{checked:!1,name:"其他"}],wasteCountValue:"",saveBaseDataList:[]}},onLoad:function(e){this.$set(this,"recordPhotoes",this.recordPhotoes.splice(1,1)),this.$emit("changeRecordPhotoes",this.recordPhotoes);var o=e.item_sn,t=e.order_id;console.log("护理记录订单itemSn ",o),this.itemSn=o,this.order_id=t;var n=i.default.get("sendPersonInfo");this.appraisePerson=n,console.log("护理记录订单options ",this.appraisePerson),this.step_id=n.step_id,console.log("护理记录订单step_id ",this.step_id)},methods:{inputData:function(e,o){console.log("医疗废物重量或数量event ",e,o),this.wasteCountValue=e},submitNursingRecordFun:function(){if(""!=this.wasteCountValue)if(0!=this.recordPhotoes.length){this.uploadImagesFun(0)}else e.showToast({title:"请选择照片",icon:"none"});else e.showToast({title:"请填写医废废物重量",icon:"none"})},uploadImagesFun:function(o){var t=this;console.log("医废照片files",this.recordPhotoes);e.uploadFile({url:"https://api.depin.tech/file/upload",filePath:this.recordPhotoes[o],name:"file",formData:{token:"3252348cc6324c00a2b585ca2ec1cc87",cate:"医废照片"},success:function(n){console.log("医废照片uploadRes",n);var s=JSON.parse(n.data);if(console.log("医废照片resData",s),0===s.code)if(t.imageUrl.push(s.data.url),o++,o==t.recordPhotoes.length){for(var i=0;i<t.imageUrl.length;i++)t.attach+=t.imageUrl[i]+",";t.attach=t.attach.substring(0,t.attach.length-1)}else t.uploadImagesFun(o);else console.log(s),e.hideLoading(),e.showToast({icon:"none",title:"图片上传失败"})},fail:function(e){console.log("医废照片error",e)}})},uploadSignInfoFun:function(){""==this.signImage&&e.showToast({title:"请签名",icon:"none"});var o={token:i.default.get(s.TOKEN),cate:"签退签字"};e.uploadFile({url:"https://api.depin.tech/file/upload",filePath:this.signImage,name:"file",formData:o,success:function(e){console.log("上传签名res",e);e.url,e.uid},fail:function(e){console.log("上传签名error",e)}})},addImage:function(){var o=this;this.recordPhotoes.length>=this.maxCount?e.showToast({title:"最多上传四张图片",icon:"none",complete:function(e){o.$emit("changeRecordPhotoes",o.recordPhotoes)}}):e.chooseImage({count:4,success:function(e){for(var t=[],n=0;n<o.recordPhotoes.length;n++)t.push(o.recordPhotoes[n]);if(o.maxSelect>0)for(n=0;n<Math.min(o.maxSelect-o.recordPhotoes.length,e.tempFilePaths.length);n++)t.push(e.tempFilePaths[n]);else for(n=0;n<e.tempFilePaths.length;n++)t.push(e.tempFilePaths[n]);o.$set(o,"recordPhotoes",t),o.$emit("changeRecordPhotoes",o.recordPhotoes)},fail:function(e){console.log("选取图片err",e),o.$emit("changeRecordPhotoes",o.recordPhotoes)}})},imageMenu:function(o){var t=this;e.showActionSheet({itemList:["向前移动","向后移动","替换图片","删除图片"],success:function(n){if(console.log(n.tapIndex),0==n.tapIndex)if(o>0){var s=t.recordPhotoes,i=s[o];s[o]=s[o-1],s[o-1]=i;for(var c=[],a=0;a<s.length;a++)c.push(s[a]);t.$set(t,"recordPhotoes",c),t.$emit("changeRecordPhotoes",t.recordPhotoes)}else e.showToast({title:"无可替换",icon:"none",complete:function(e){t.$emit("changeRecordPhotoes",t.recordPhotoes)}});else if(1==n.tapIndex)if(o<t.recordPhotoes.length-1){s=t.recordPhotoes,i=s[o];s[o]=s[o+1],s[o+1]=i;for(c=[],a=0;a<s.length;a++)c.push(s[a]);t.$set(t,"recordPhotoes",c),t.$emit("changeRecordPhotoes",t.recordPhotoes)}else e.showToast({title:"无可替换",icon:"none",complete:function(e){t.$emit("changeRecordPhotoes",t.recordPhotoes)}});else 2==n.tapIndex?e.chooseImage({count:4,success:function(e){for(var n=t.recordPhotoes,s=[],i=0;i<n.length;i++)o!=i?s.push(n[i]):s.push(e.tempFilePaths[0]);t.$set(t,"recordPhotoes",s),t.$emit("changeRecordPhotoes",t.recordPhotoes)},fail:function(e){t.$emit("changeRecordPhotoes",t.recordPhotoes)}}):3==n.tapIndex&&e.showModal({title:"消息",content:"您确认删除该图片吗？",success:function(e){if(e.confirm){for(var n=t.recordPhotoes,s=[],i=0;i<n.length;i++)o!=i&&s.push(n[i]);t.$set(t,"recordPhotoes",s),t.$emit("changeRecordPhotoes",t.recordPhotoes)}else t.$emit("changeRecordPhotoes",t.recordPhotoes)},fail:function(e){t.$emit("changeRecordPhotoes",t.recordPhotoes)}})}})},viewImage:function(o){e.previewImage({urls:this.result,current:o})},doss:function(){this.isShowSign=!0},closeSign:function(){this.isShowSign=!1},saveSign:function(e){this.isShowSign=!1,this.signImage=this.$refs.catSign.signImage,console.log("执行中签名signImage",this.signImage)},multiHandle:function(e,o){this.wasteSortList[o].checked=!this.wasteSortList[o].checked}},props:{type:{type:String,default:"image"},maxSelect:{type:Number,default:-1}}});o.default=c}).call(this,t("543d")["default"])}},[["ee42","common/runtime","common/vendor","bundle/common/vendor"]]]);