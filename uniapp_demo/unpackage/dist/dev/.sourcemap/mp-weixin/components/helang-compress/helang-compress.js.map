{"version":3,"sources":["webpack:////Users/wangyunzhu/Desktop/yinjiangtao/uniapp_demo/uniapp_demo/components/helang-compress/helang-compress.vue?6154","webpack:////Users/wangyunzhu/Desktop/yinjiangtao/uniapp_demo/uniapp_demo/components/helang-compress/helang-compress.vue?fd86","webpack:////Users/wangyunzhu/Desktop/yinjiangtao/uniapp_demo/uniapp_demo/components/helang-compress/helang-compress.vue?bcbb","webpack:////Users/wangyunzhu/Desktop/yinjiangtao/uniapp_demo/uniapp_demo/components/helang-compress/helang-compress.vue?0b25","uni-app:///components/helang-compress/helang-compress.vue","webpack:////Users/wangyunzhu/Desktop/yinjiangtao/uniapp_demo/uniapp_demo/components/helang-compress/helang-compress.vue?eed6"],"names":["renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","data","pic","canvasSize","width","height","canvasId","mounted","uni","methods","compressFun","info","reject","maxSize","minSize","resolve","setTimeout","ctx","x","y","destWidth","destHeight","fileType","quality","success","fail","getImageInfo","src","compress","done","waitList","next","path","paths","params","count","index","start","batch","res"],"mappings":"2IAAA,oIACIA,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,iDACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G,iCCRvB,yHAA42B,eAAG,G,uJCO/2B,CACAC,gBACA,OACAC,OACAC,YACAC,QACAC,UAEAC,cAGAC,mBACA,6BAGAC,4BAFAA,4BAIA,mEAEAC,SAEAC,wBAAA,WACA,wLAEA,+FAAAC,SAEAA,GAAA,eACA,OAAAC,cAAA,0BAWA,GANAC,kBACAC,iBAGAV,uBAIAA,aAAA,gBACA,OAAAW,SAAA,4BAMA,YACA,KACAV,sBACAD,MAEAA,sBACAC,MAKA,uBACAD,wBACAC,2BAKAW,uBACA,0CACAC,qBACAA,4BACAA,sBACAT,wBACAU,IACAC,IACAf,QACAC,SACAe,YACAC,aACAf,oBACAgB,2BACAC,sBACAC,oBAEAT,mBAEAU,iBACAb,UAEA,QAEA,iDACA,qDApEA,KAuEAc,yBACA,kCACAlB,gBACAmB,MACAH,oBACAT,MAEAU,gBACAb,eAMAgB,qBAAA,WAEA,IAAAC,IAAAJ,IAEA,KAEA,KAEAK,EADA,uBACAA,QAEAA,MAGA,iBACA,kCAEA,gKAEAC,sBAAA,sBAAAC,SACA,GACAH,IACAI,WAEAR,IAGAS,wBACAL,OACAJ,OACAU,iBAGAC,IAEA,YACArB,MAEAsB,IACA,2CACA,kBAvBA,mCAwBAA,QAIA,aACA,sBACAV,SACAd,kBACAS,oBACAC,kBACAT,qBAKA,gLAEAwB,IAAA,OAAAC,SACA,EACA,uBACAxB,QAEAA,KAGAH,QACA,2CACA,qDAZA,OAeA,c,6DCxLA,yHAA+mD,eAAG,G","file":"components/helang-compress/helang-compress.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./helang-compress.vue?vue&type=template&id=5ece160e&scoped=true&\"\nvar renderjs\nimport script from \"./helang-compress.vue?vue&type=script&lang=js&\"\nexport * from \"./helang-compress.vue?vue&type=script&lang=js&\"\nimport style0 from \"./helang-compress.vue?vue&type=style&index=0&id=5ece160e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5ece160e\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/helang-compress/helang-compress.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./helang-compress.vue?vue&type=template&id=5ece160e&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./helang-compress.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./helang-compress.vue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"compress\" v-if=\"canvasId\">\n\t\t<canvas :canvas-id=\"canvasId\" :style=\"{ width: canvasSize.width,height: canvasSize.height}\"></canvas>\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tpic:'',\n\t\t\t\tcanvasSize: {\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 0\n\t\t\t\t},\n\t\t\t\tcanvasId:\"\"\n\t\t\t}\n\t\t},\n\t\tmounted() {\n\t\t\tif(!uni || !uni._helang_compress_canvas){\n\t\t\t\tuni._helang_compress_canvas = 1;\n\t\t\t}else{\n\t\t\t\tuni._helang_compress_canvas++;\n\t\t\t}\n\t\t\tthis.canvasId = `compress-canvas${uni._helang_compress_canvas}`;\n\t\t},\n\t\tmethods: {\n\t\t\t// 压缩\n\t\t\tcompressFun(params) {\n\t\t\t\treturn new Promise(async (resolve, reject) => {\n\t\t\t\t\t// 等待图片信息\n\t\t\t\t\tlet info = await this.getImageInfo(params.src).then(info=>info).catch(()=>null);\n\t\t\t\t\t\n\t\t\t\t\tif(!info){\n\t\t\t\t\t\treject('获取图片信息异常');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// 设置最大 & 最小 尺寸\n\t\t\t\t\tconst maxSize = params.maxSize || 1080;\n\t\t\t\t\tconst minSize = params.minSize || 640;\n\t\t\t\t\t\n\t\t\t\t\t// 当前图片尺寸\n\t\t\t\t\tlet {width,height} = info;\n\t\t\t\t\t\n\t\t\t\t\t// 非 H5 平台进行最小尺寸校验\n\t\t\t\t\t// #ifndef H5\n\t\t\t\t\tif(width <= minSize && height <= minSize){\n\t\t\t\t\t\tresolve(params.src);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// #endif\n\t\t\t\t\t\n\t\t\t\t\t// 最大尺寸计算\n\t\t\t\t\tif (width > maxSize || height > maxSize) {\n\t\t\t\t\t\tif (width > height) {\n\t\t\t\t\t\t\theight = Math.floor(height / (width / maxSize));\n\t\t\t\t\t\t\twidth = maxSize;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidth = Math.floor(width / (height / maxSize));\n\t\t\t\t\t\t\theight = maxSize;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// 设置画布尺寸\n\t\t\t\t\tthis.$set(this,\"canvasSize\",{\n\t\t\t\t\t\twidth: `${width}px`,\n\t\t\t\t\t\theight: `${height}px`\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t// Vue.nextTick 回调在 App 有异常，则使用 setTimeout 等待DOM更新\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tconst ctx = uni.createCanvasContext(this.canvasId, this);\n\t\t\t\t\t\tctx.clearRect(0,0,width, height)\n\t\t\t\t\t\tctx.drawImage(info.path, 0, 0, width, height);\n\t\t\t\t\t\tctx.draw(false, () => {\n\t\t\t\t\t\t\tuni.canvasToTempFilePath({\n\t\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\t\t\theight: height,\n\t\t\t\t\t\t\t\tdestWidth: width,\n\t\t\t\t\t\t\t\tdestHeight: height,\n\t\t\t\t\t\t\t\tcanvasId: this.canvasId,\n\t\t\t\t\t\t\t\tfileType: params.fileType || 'png',\n\t\t\t\t\t\t\t\tquality: params.quality || 0.9,\n\t\t\t\t\t\t\t\tsuccess: (res) => {\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// 在H5平台下，tempFilePath 为 base64\n\t\t\t\t\t\t\t\t\tresolve(res.tempFilePath);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tfail:(err)=>{\n\t\t\t\t\t\t\t\t\treject(null);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},this);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, 300);\n\t\t\t\t});\n\t\t\t},\n\t\t\t// 获取图片信息\n\t\t\tgetImageInfo(src){\n\t\t\t\treturn new Promise((resolve, reject)=>{\n\t\t\t\t\tuni.getImageInfo({\n\t\t\t\t\t\tsrc,\n\t\t\t\t\t\tsuccess: (info)=> {\n\t\t\t\t\t\t\tresolve(info);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfail: () => {\n\t\t\t\t\t\t\treject(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\t// 批量压缩\n\t\t\tcompress(params){\n\t\t\t\t// index:进度，done:成功，fail:失败\n\t\t\t\tlet [index,done,fail] = [0,0,0];\n\t\t\t\t// 压缩完成的路径集合\n\t\t\t\tlet paths = [];\n\t\t\t\t// 待压缩的图片\n\t\t\t\tlet waitList = [];\n\t\t\t\tif(typeof params.src == 'string'){\n\t\t\t\t\twaitList = [params.src];\n\t\t\t\t}else{\n\t\t\t\t\twaitList = params.src;\n\t\t\t\t}\n\t\t\t\t// 批量压缩方法\n\t\t\t\tlet batch = ()=>{\n\t\t\t\t\treturn new Promise((resolve, reject)=>{\n\t\t\t\t\t\t// 开始\n\t\t\t\t\t\tlet start = async ()=>{\n\t\t\t\t\t\t\t// 等待图片压缩方法返回\n\t\t\t\t\t\t\tlet path = await next().catch(()=>null);\n\t\t\t\t\t\t\tif(path){\n\t\t\t\t\t\t\t\tdone++;\n\t\t\t\t\t\t\t\tpaths.push(path);\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tfail++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tparams.progress && params.progress({\n\t\t\t\t\t\t\t\tdone,\n\t\t\t\t\t\t\t\tfail,\n\t\t\t\t\t\t\t\tcount:waitList.length\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tindex++;\n\t\t\t\t\t\t\t// 压缩完成\n\t\t\t\t\t\t\tif(index >= waitList.length){\n\t\t\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tstart();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstart();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// 依次调用压缩方法\n\t\t\t\tlet next = ()=>{\n\t\t\t\t\treturn this.compressFun({\n\t\t\t\t\t\tsrc:waitList[index],\n\t\t\t\t\t\tmaxSize:params.maxSize,\n\t\t\t\t\t\tfileType:params.fileType,\n\t\t\t\t\t\tquality:params.quality,\n\t\t\t\t\t\tminSize:params.minSize\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 全部压缩完成后调用\n\t\t\t\treturn new Promise(async (resolve, reject)=>{\n\t\t\t\t\t// 批量压缩方法回调\n\t\t\t\t\tlet res = await batch();\n\t\t\t\t\tif(res){\n\t\t\t\t\t\tif(typeof params.src == 'string'){\n\t\t\t\t\t\t\tresolve(paths[0]);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tresolve(paths);\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\treject(null);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\" scoped>\n\t.compress{\n\t\tposition: fixed;\n\t\twidth: 12px;\n\t\theight: 12px;\n\t\toverflow: hidden;\n\t\ttop: -99999px;\n\t\tleft: 0;\n\t}\n</style>\n","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./helang-compress.vue?vue&type=style&index=0&id=5ece160e&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./helang-compress.vue?vue&type=style&index=0&id=5ece160e&lang=scss&scoped=true&\""],"sourceRoot":""}